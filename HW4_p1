from sklearn import datasets
from sklearn.svm import SVC
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import (
    accuracy_score, precision_score, recall_score, f1_score,
    confusion_matrix, ConfusionMatrixDisplay
)
import numpy as np
import matplotlib.pyplot as plt

# load data
data = datasets.load_breast_cancer()
X = data.data
y = data.target

# split and scale
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)
scaler = StandardScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

# train/evaluate SVMs with several kernels
kernels = ['linear', 'poly', 'rbf', 'sigmoid']
metrics_by_kernel = {}
cms_by_kernel = {}

for k in kernels:
    svm = SVC(kernel=k, C=1.0)
    svm.fit(X_train, y_train)
    y_pred = svm.predict(X_test)

    acc = accuracy_score(y_test, y_pred)
    prec = precision_score(y_test, y_pred)
    rec = recall_score(y_test, y_pred)
    f1 = f1_score(y_test, y_pred)
    cm = confusion_matrix(y_test, y_pred)

    metrics_by_kernel[k] = [acc, prec, rec, f1]
    cms_by_kernel[k] = cm

    print("kernel:", k)
    print("Accuracy :", acc)
    print("Precision:", prec)
    print("Recall   :", rec)
    print("F1 Score :", f1)
    print(" ")

# fixed HW3 summary
Hw3_accuracy = 0.9824561403508771
Hw3_precision = 0.9726027397260274
Hw3_recall = 1.0
Hw3_f1 = 0.9861111111111112
Hw3_cm = np.array([[41, 2],
                   [0, 71]])

print("HW3 Results:")
print("Accuracy :", Hw3_accuracy)
print("Precision:", Hw3_precision)
print("Recall   :", Hw3_recall)
print("F1 Score :", Hw3_f1)
print(" ")

# select kernel with highest accuracy
best_kernel = None
best_acc = 0
for k in metrics_by_kernel:
    if metrics_by_kernel[k][0] > best_acc:
        best_acc = metrics_by_kernel[k][0]
        best_kernel = k

# plot confusion matrices
fig, ax = plt.subplots(1, 2, figsize=(12, 5))

ConfusionMatrixDisplay(
    confusion_matrix=cms_by_kernel[best_kernel],
    display_labels=data.target_names
).plot(ax=ax[0], cmap='Blues')
ax[0].set_title(f"SVM ({best_kernel} kernel) Confusion Matrix")

ConfusionMatrixDisplay(
    confusion_matrix=Hw3_cm,
    display_labels=data.target_names
).plot(ax=ax[1], cmap='Reds')
ax[1].set_title("Logistic Regression (HW3) Confusion Matrix")

plt.tight_layout()
plt.show()
